
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSecure Pro v4.0 - P2P</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        :root { --primary: #06b6d4; --accent: #f43f5e; --bg: #020617; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(at 0% 0%, rgba(6, 182, 212, 0.15) 0px, transparent 50%), radial-gradient(at 100% 100%, rgba(244, 63, 94, 0.1) 0px, transparent 50%);
            color: #f1f5f9; min-height: 100vh; margin: 0;
        }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .video-container { position: relative; overflow: hidden; border-radius: 2rem; background: #000; border: 1px solid rgba(255,255,255,0.1); }
        .scan-line { width: 100%; height: 2px; background: linear-gradient(to right, transparent, var(--primary), transparent); position: absolute; top: 0; left: 0; animation: scan 3s linear infinite; z-index: 10; opacity: 0.5; }
        @keyframes scan { 0% { top: 0%; } 100% { top: 100%; } }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0",
    "qrcode.react": "https://esm.sh/qrcode.react@3.1.0",
    "peerjs": "https://esm.sh/peerjs@1.5.2",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root">
        <!-- Tela de carregamento inicial enquanto o Babel processa -->
        <div style="height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <div style="width: 40px; height: 40px; border: 3px solid rgba(6,182,212,0.1); border-top-color: #06b6d4; border-radius: 50%; animation: spin 1s linear infinite;"></div>
            <p style="margin-top: 20px; font-size: 10px; font-weight: 900; letter-spacing: 4px; color: #06b6d4; text-transform: uppercase;">Iniciando Sistema...</p>
        </div>
    </div>

    <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

    <!-- O Babel vai ler este script e transformar o código em tempo real -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom';
        import { QRCodeSVG } from 'qrcode.react';
        import Peer from 'peerjs';

        // --- COMPONENTES ---

        const Home = ({ onSelectMode }) => (
            <div className="flex flex-col items-center w-full mt-12 animate-pulse-slow">
                <div className="text-center mb-16">
                    <h2 className="text-4xl md:text-5xl font-black text-white mb-4">WebSecure <span className="text-cyan-500">P2P</span></h2>
                    <p className="text-slate-400">Monitoramento privado sem servidores.</p>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 w-full max-w-3xl">
                    <div onClick={() => onSelectMode('CAMERA')} className="glass p-10 rounded-[2.5rem] cursor-pointer hover:bg-slate-800/80 transition-all border-2 border-transparent hover:border-rose-500/30 flex flex-col items-center">
                        <div className="w-20 h-20 bg-rose-500/10 rounded-2xl flex items-center justify-center mb-6">
                            <i className="fas fa-video text-4xl text-rose-500"></i>
                        </div>
                        <h3 className="text-xl font-bold mb-2">Modo Câmera</h3>
                        <p className="text-slate-500 text-sm text-center mb-6">Use este celular como câmera.</p>
                        <div className="w-full bg-rose-600 py-3 rounded-xl font-bold text-center">COMEÇAR</div>
                    </div>
                    <div onClick={() => onSelectMode('MONITOR')} className="glass p-10 rounded-[2.5rem] cursor-pointer hover:bg-slate-800/80 transition-all border-2 border-transparent hover:border-cyan-500/30 flex flex-col items-center">
                        <div className="w-20 h-20 bg-cyan-500/10 rounded-2xl flex items-center justify-center mb-6">
                            <i className="fas fa-desktop text-4xl text-cyan-500"></i>
                        </div>
                        <h3 className="text-xl font-bold mb-2">Modo Monitor</h3>
                        <p className="text-slate-500 text-sm text-center mb-6">Veja as câmeras remotas.</p>
                        <div className="w-full bg-cyan-600 py-3 rounded-xl font-bold text-center">CONECTAR</div>
                    </div>
                </div>
            </div>
        );

        const CameraMode = () => {
            const [id, setId] = useState('');
            const videoRef = useRef();
            const peerRef = useRef();

            useEffect(() => {
                const camId = 'CAM-' + Math.floor(Math.random() * 9000 + 1000);
                const peer = new Peer(camId);
                peerRef.current = peer;

                peer.on('open', setId);
                peer.on('call', async (call) => {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    videoRef.current.srcObject = stream;
                    call.answer(stream);
                });

                navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(s => {
                    if(videoRef.current) videoRef.current.srcObject = s;
                });

                return () => peer.destroy();
            }, []);

            const link = `${window.location.origin}${window.location.pathname}?id=${id}`;

            return (
                <div className="w-full max-w-2xl flex flex-col items-center gap-6">
                    <div className="video-container aspect-video w-full">
                        <video ref={videoRef} autoPlay playsInline muted className="w-full h-full object-cover" />
                        <div className="scan-line"></div>
                        <div className="absolute top-4 left-4 bg-black/50 px-3 py-1 rounded-full text-[10px] font-bold">TRANSMITINDO</div>
                    </div>
                    <div className="glass p-6 rounded-3xl w-full flex flex-col md:flex-row items-center gap-6">
                        <div className="flex-grow">
                            <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">ID da Câmera</p>
                            <div className="text-3xl font-mono font-black text-white mt-1">{id || '...'}</div>
                            <button onClick={() => { navigator.clipboard.writeText(link); alert('Link copiado!'); }} className="mt-4 text-xs font-bold text-rose-500 uppercase">Copiar Link de Acesso</button>
                        </div>
                        <div className="bg-white p-2 rounded-xl">
                            {id && <QRCodeSVG value={link} size={100} />}
                        </div>
                    </div>
                </div>
            );
        };

        const MonitorMode = ({ initialId }) => {
            const [targetId, setTargetId] = useState(initialId || '');
            const [active, setActive] = useState(false);
            const videoRef = useRef();
            const peerRef = useRef();

            useEffect(() => {
                const peer = new Peer();
                peerRef.current = peer;
                if(initialId) connect(initialId);
                return () => peer.destroy();
            }, []);

            const connect = (id) => {
                const call = peerRef.current.call(id, new MediaStream());
                call.on('stream', (s) => {
                    setActive(true);
                    videoRef.current.srcObject = s;
                });
            };

            return (
                <div className="w-full max-w-2xl flex flex-col items-center gap-6">
                    <div className="video-container aspect-video w-full flex items-center justify-center">
                        {active ? <video ref={videoRef} autoPlay playsInline className="w-full h-full" /> : <i className="fas fa-video-slash text-4xl text-slate-800"></i>}
                    </div>
                    <div className="glass p-6 rounded-3xl w-full flex gap-4">
                        <input value={targetId} onChange={e => setTargetId(e.target.value)} placeholder="ID da Câmera" className="bg-black/50 border border-white/10 rounded-xl px-4 flex-grow font-mono outline-none focus:border-cyan-500" />
                        <button onClick={() => connect(targetId)} className="bg-cyan-600 px-6 py-3 rounded-xl font-bold">CONECTAR</button>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [mode, setMode] = useState('IDLE');
            const [urlId, setUrlId] = useState('');

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const id = params.get('id');
                if(id) { setMode('MONITOR'); setUrlId(id); }
            }, []);

            return (
                <div className="p-4 flex flex-col items-center">
                    <header className="w-full max-w-4xl flex justify-between items-center py-8">
                        <div className="flex items-center gap-3 cursor-pointer" onClick={() => setMode('IDLE')}>
                            <div className="bg-cyan-500 p-2 rounded-xl"><i className="fas fa-shield-halved text-white"></i></div>
                            <h1 className="font-black text-xl">WEBSAFE</h1>
                        </div>
                        {mode !== 'IDLE' && <button onClick={() => setMode('IDLE')} className="text-xs font-bold text-slate-500 uppercase">Voltar</button>}
                    </header>
                    {mode === 'IDLE' && <Home onSelectMode={setMode} />}
                    {mode === 'CAMERA' && <CameraMode />}
                    {mode === 'MONITOR' && <MonitorMode initialId={urlId} />}
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
